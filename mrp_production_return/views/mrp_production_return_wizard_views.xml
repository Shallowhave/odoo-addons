<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="mrp_production_return_wizard_view_form" model="ir.ui.view">
        <field name="name">mrp.production.return.wizard.form</field>
        <field name="model">mrp.production.return.wizard</field>
        <field name="arch" type="xml">
            <form string="处理剩余组件">
                <header>
                    <field name="return_strategy" widget="radio" options="{'horizontal': true}"/>
                </header>
                
                       <group>
                           <group string="基本信息">
                               <field name="production_id" readonly="1"/>
                           </group>
                           <group string="目标位置">
                               <field name="defective_location_id" 
                                      invisible="return_strategy != 'defective'"
                                      required="return_strategy == 'defective'"/>
                               <field name="scrap_location_id" 
                                      invisible="return_strategy != 'scrap'"
                                      required="return_strategy == 'scrap'"/>
                               <field name="target_location_id" invisible="1"/>
                               <field name="location_name" readonly="1" 
                                      string="目标位置" 
                                      invisible="return_strategy in ('defective', 'scrap') or not target_location_id"
                                      help="生产前位置：原材料位置；生产后位置：成品位置"/>
                           </group>
                       </group>
                       
                   <group string="剩余组件">
                       <div class="oe_button_box" name="button_box">
                           <button name="action_add_available_components" 
                                   string="添加可用组件" 
                                   type="object" 
                                   class="oe_stat_button"
                                   icon="fa-plus"/>
                       </div>
                       <field name="component_line_ids" nolabel="1" 
                              widget="one2many_list"
                              context="{'default_wizard_id': id}"
                              options="{'no_create_edit': False}"/>
                   </group>
                
                <group string="原因和备注">
                    <field name="return_reason_id" 
                           domain="[('return_strategy', 'in', [return_strategy, False])]"/>
                    <field name="custom_reason" 
                           invisible="return_reason_id"
                           placeholder="请填写自定义原因..."/>
                    <field name="notes" placeholder="额外的处理说明..."/>
                </group>
                
                <group string="处理选项">
                    <field name="auto_confirm_picking"/>
                    <field name="send_notification"/>
                </group>
                
                <footer>
                    <button name="action_confirm_return" 
                            string="确认处理" 
                            type="object" 
                            class="btn-primary"/>
                    <button string="取消" 
                            class="btn-secondary" 
                            special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
    
</odoo>
