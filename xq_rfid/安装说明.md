# RFID 模块安装说明

**更新日期**: 2025-10-17  
**版本**: 18.0.1.0.0

---

## 📋 安装步骤

### 方法 1：通过 Odoo 界面安装

1. **更新应用列表**
   - 进入 Odoo
   - 点击"应用"菜单
   - 点击右上角的"更新应用列表"
   - 确认更新

2. **安装模块**
   - 在搜索框输入 "RFID" 或 "xq_rfid"
   - 找到 "RFID 标签管理" 模块
   - 点击"安装"按钮

3. **等待安装完成**
   - 安装过程可能需要几秒钟
   - 安装成功后会自动刷新页面

### 方法 2：通过命令行安装

```bash
./odoo-bin -i xq_rfid -d your_database
```

### 方法 3：升级已安装的模块

```bash
./odoo-bin -u xq_rfid -d your_database
```

---

## ⚠️ 重要：数据库约束修复

安装/升级后，**必须**执行以下 SQL 删除旧的约束：

### 步骤 1：连接数据库

```bash
psql -U odoo -d your_database
```

### 步骤 2：删除旧约束

```sql
ALTER TABLE rfid_tag DROP CONSTRAINT IF EXISTS rfid_tag_uniq_product;
ALTER TABLE rfid_tag DROP CONSTRAINT IF EXISTS rfid_tag_uniq_picking;
```

### 步骤 3：验证约束

```sql
SELECT conname 
FROM pg_constraint 
WHERE conrelid = 'rfid_tag'::regclass 
AND conname LIKE 'rfid_tag_uniq%';
```

**期望结果**（应该只有两个）:
```
rfid_tag_uniq_name
rfid_tag_uniq_stock_prod_lot
```

### 步骤 4：退出数据库

```sql
\q
```

---

## ✅ 验证安装

### 检查菜单

安装成功后，应该可以看到：

```
RFID（主菜单）
├── RFID
│   └── RFID 标签
└── 配置
    └── 设备配置
```

### 检查功能

1. **创建质检点**
   - 进入：质量 → 质量控制 → 质量检查点
   - 点击"新建"
   - 测试类型中应该有 **"RFID 标签"** 选项

2. **查看 RFID 标签**
   - 进入：RFID → RFID → RFID 标签
   - 应该可以看到 RFID 标签列表（初始为空）

3. **查看设备配置**
   - 进入：RFID → 配置 → 设备配置
   - 应该可以创建和配置 RFID 设备

---

## 🔧 常见安装问题

### 问题 1：External ID not found

**错误信息**：
```
ValueError: External ID not found in the system: xq_rfid.rfid_tag_view_act_window
```

**原因**：数据加载顺序问题（已在最新版本中修复）

**解决方法**：
- 确保使用最新版本的代码
- 卸载后重新安装模块

### 问题 2：约束冲突

**错误信息**：
```
duplicate key value violates unique constraint "rfid_tag_uniq_product"
```

**原因**：旧的不合理约束未删除

**解决方法**：
按照上面"数据库约束修复"部分执行 SQL

### 问题 3：模块依赖缺失

**错误信息**：
```
Module xq_rfid depends on module quality_control which is not installed
```

**解决方法**：
安装缺失的依赖模块：
- `mrp` - 生产制造
- `stock` - 库存管理
- `quality_control` - 质量控制
- `mrp_workorder` - 生产工单

```bash
./odoo-bin -i mrp,stock,quality_control,mrp_workorder -d your_database
```

---

## 🔄 升级现有模块

如果已经安装了旧版本，需要升级：

### 方法 1：界面升级

1. 进入"应用"菜单
2. 搜索 "RFID"
3. 点击"升级"按钮
4. 执行数据库约束修复（见上面）

### 方法 2：命令行升级

```bash
# 升级模块
./odoo-bin -u xq_rfid -d your_database

# 然后执行 SQL 删除约束（见上面）
```

---

## 📊 模块结构

安装后会创建以下数据：

### 数据表

- `rfid_tag` - RFID 标签主表
- `rfid_device_config` - RFID 设备配置表

### 菜单

- RFID 主菜单
- RFID 标签管理菜单
- 设备配置菜单

### 质检类型

- RFID 标签（technical_name: `rfid_label`）

### 序列

- RFID 标签编号序列（前缀: RFID, 6位数字）

---

## 🎯 安装后配置

### 1. 创建第一个质检点

```
质量 → 质量控制 → 质量检查点
├── 产品：选择需要 RFID 的产品
├── 操作：Manufacturing（生产）
├── 测试类型：RFID 标签 ⭐
└── 工作中心：选择相应工序
```

### 2. 配置 RFID 设备（可选）

```
RFID → 配置 → 设备配置
├── 设备名称：例如"读写器001"
├── 设备类型：模拟设备/USB/串口/网络
└── 连接参数：根据实际设备填写
```

### 3. 测试功能

```
1. 创建生产订单
2. 设置成品批次号
3. 执行到 RFID 质检点
4. 点击"通过"按钮
5. 系统自动生成 RFID 标签
6. 查看生产订单的 RFID 标签列表
```

---

## 📚 相关文档

安装完成后，建议阅读：

- **`使用说明.md`** - 详细使用指南
- **`功能更新说明.md`** - 功能说明
- **`README.md`** - 模块概述
- **`QUICK_FIX.md`** - 快速问题修复
- **`DATABASE_MIGRATION.md`** - 数据库迁移详细说明

---

## 🔒 权限配置

默认权限：
- 所有登录用户（`base.group_user`）都可以访问 RFID 功能
- 如需修改权限，编辑 `security/ir.model.access.csv`

---

## 🚀 快速开始

```
1. 安装模块 ✅
   ↓
2. 删除旧约束（SQL） ✅
   ↓
3. 创建质检点（测试类型：RFID 标签） ✅
   ↓
4. 创建生产订单并测试 ✅
   ↓
5. 查看生成的 RFID 标签 ✅
```

---

## 📞 技术支持

- **开发者**: Grit
- **官网**: https://ifangtech.com
- **版本**: 18.0.1.0.0

如遇到安装问题，请提供：
1. 完整的错误日志
2. Odoo 版本号
3. 数据库类型和版本
4. 已安装的相关模块列表

---

## ✨ 安装检查清单

安装完成后，请检查：

- [ ] 模块安装成功，无错误
- [ ] 可以看到 RFID 菜单
- [ ] 删除了旧的数据库约束
- [ ] 质检点中有"RFID 标签"测试类型
- [ ] 可以创建和查看 RFID 标签
- [ ] 可以配置 RFID 设备
- [ ] 生产流程中可以生成 RFID

**全部完成？恭喜！开始使用 RFID 模块吧！** 🎉

