# stock_unit_mgmt æ’ä»¶é‡æ–°è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
1. [ä¸šåŠ¡éœ€æ±‚åˆ†æ](#ä¸šåŠ¡éœ€æ±‚åˆ†æ)
2. [å½“å‰é—®é¢˜æ€»ç»“](#å½“å‰é—®é¢˜æ€»ç»“)
3. [é‡æ–°è®¾è®¡ç›®æ ‡](#é‡æ–°è®¾è®¡ç›®æ ‡)
4. [æ–°æ¶æ„è®¾è®¡](#æ–°æ¶æ„è®¾è®¡)
5. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
6. [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
7. [è§†å›¾ä¸äº¤äº’è®¾è®¡](#è§†å›¾ä¸äº¤äº’è®¾è®¡)
8. [æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ](#æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ)
9. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)

---

## 1. ä¸šåŠ¡éœ€æ±‚åˆ†æ

### 1.1 äº§å“ç±»å‹ä¸å•ä½éœ€æ±‚

#### äº§å“åˆ†ç±»
1. **åŸè†œï¼ˆRaw Filmï¼‰**
   - ä¸»å•ä½ï¼škgï¼ˆå…¬æ–¤ï¼‰
   - é™„åŠ å•ä½ï¼šå·ï¼ˆrollï¼‰
   - å±æ€§ï¼šå®½åº¦(mm)ã€åšåº¦(Î¼m)ã€é•¿åº¦(m)
   - ä½¿ç”¨åœºæ™¯ï¼šé‡‡è´­å…¥åº“ã€ç”Ÿäº§é¢†ç”¨ã€åº“å­˜ç®¡ç†

2. **æˆå“è†œï¼ˆFinished Filmï¼‰**
   - ä¸»å•ä½ï¼škgï¼ˆå…¬æ–¤ï¼‰
   - é™„åŠ å•ä½ï¼šå¹³æ–¹ç±³(ã¡)ã€å·ï¼ˆrollï¼‰
   - å±æ€§ï¼šå®½åº¦(mm)ã€åšåº¦(Î¼m)ã€é•¿åº¦(m)ã€å‘è´§é‡é‡ç³»æ•°(g/ã¡)ã€å•ä½é‡é‡(kg/mÂ²)
   - ä½¿ç”¨åœºæ™¯ï¼šç”Ÿäº§å…¥åº“ã€é”€å”®å‡ºåº“ã€å‘è´§ç®¡ç†

3. **æ¶²ä½“/é…æ¶²åŸæ–™ï¼ˆLiquid/Solution Materialï¼‰**
   - ä¸»å•ä½ï¼škgï¼ˆå…¬æ–¤ï¼‰
   - é™„åŠ å•ä½ï¼šæ¡¶ï¼ˆbarrelï¼‰
   - å±æ€§ï¼šå›ºå«(%)ã€ç²˜åº¦å€¼
   - ä½¿ç”¨åœºæ™¯ï¼šé‡‡è´­å…¥åº“ã€é…æ¶²ä½¿ç”¨

4. **åŠæˆå“åŸè†œï¼ˆSemi-Finished Raw Filmï¼‰**
   - ä¸»å•ä½ï¼škgï¼ˆå…¬æ–¤ï¼‰
   - é™„åŠ å•ä½ï¼šå·ï¼ˆrollï¼‰
   - å±æ€§ï¼šç±»ä¼¼åŸè†œ
   - ä½¿ç”¨åœºæ™¯ï¼šå†…éƒ¨æµè½¬ã€ç”Ÿäº§ä½¿ç”¨

### 1.2 æ ¸å¿ƒä¸šåŠ¡åœºæ™¯

#### åœºæ™¯1ï¼šé‡‡è´­å…¥åº“
- ä¾›åº”å•†é€è´§ï¼š30kgï¼Œ7æ¡¶
- éœ€è¦åœ¨ç³»ç»Ÿä¸­è®°å½•ï¼šä¸»å•ä½æ•°é‡30kgï¼Œé™„åŠ å•ä½7æ¡¶
- æ‰¹æ¬¡å·ï¼šppxx01
- éœ€è¦è®°å½•ï¼šåˆ°è´§æ—¥æœŸã€å¤‡æ³¨1ã€å¤‡æ³¨2ã€åˆåŒå·

#### åœºæ™¯2ï¼šåº“å­˜ç®¡ç†
- åœ¨åº“å­˜åˆ—è¡¨ä¸­æ˜¾ç¤ºï¼šä¸»å•ä½æ•°é‡ã€é™„åŠ å•ä½æ•°é‡ã€é™„åŠ å•ä½åç§°
- éœ€è¦æ”¯æŒæ±‡æ€»ç»Ÿè®¡ï¼ˆæ€»é™„åŠ å•ä½æ•°é‡ï¼‰
- éœ€è¦æ˜¾ç¤ºï¼šåˆ°è´§æ—¥æœŸã€å¤‡æ³¨1ã€å¤‡æ³¨2ã€åˆåŒå·
- éœ€è¦æ”¯æŒå®‰å…¨åº“å­˜ç®¡ç†

#### åœºæ™¯3ï¼šç”Ÿäº§é¢†ç”¨
- ä»åº“å­˜é¢†ç”¨åŸææ–™
- é™„åŠ å•ä½æ•°é‡åº”è‡ªåŠ¨å‡å°‘
- è®°å½•é¢†ç”¨çš„é™„åŠ å•ä½ä¿¡æ¯

#### åœºæ™¯4ï¼šç§»åŠ¨å†å²è¿½æº¯
- åœ¨ç§»åŠ¨å†å²ä¸­æ˜¾ç¤ºé™„åŠ å•ä½å’Œé™„åŠ å•ä½æ•°é‡
- æ”¯æŒæŒ‰é™„åŠ å•ä½ç­›é€‰å’Œæ±‡æ€»

#### åœºæ™¯5ï¼šå®‰å…¨åº“å­˜ç®¡ç†
- è®¾ç½®å®‰å…¨åº“å­˜æ•°é‡
- é…ç½®å®‰å…¨åº“å­˜è§„åˆ™ï¼ˆæ˜¯å¦åŒ…æ‹¬å¤‡æ³¨1ã€å¤‡æ³¨2ï¼‰
- å®æ—¶æ˜¾ç¤ºæ˜¯å¦è¾¾åˆ°å®‰å…¨åº“å­˜

---

## 2. å½“å‰é—®é¢˜æ€»ç»“

### 2.1 æ¶æ„é—®é¢˜
1. âŒ ç¼ºå°‘äº§å“ç±»å‹åˆ†ç±»ï¼Œæ‰€æœ‰äº§å“ä½¿ç”¨ç›¸åŒçš„å­—æ®µï¼Œå¯¼è‡´æ··ä¹±
2. âŒ å•ä½ç®¡ç†ä¸çµæ´»ï¼Œåªèƒ½é€‰æ‹©ä¸€ä¸ªé™„åŠ å•ä½æ¨¡æ¿
3. âŒ å­—æ®µå‘½åä¸è§„èŒƒï¼ˆ`lot_qty`, `act_juan`, `o_note`ï¼‰
4. âŒ ä»£ç é‡å¤ï¼Œå•ä½æ˜ å°„ä»£ç åœ¨å¤šå¤„é‡å¤

### 2.2 åŠŸèƒ½é—®é¢˜
1. âš ï¸ è®¡ç®—å­—æ®µä¾èµ–ä¸å®Œæ•´ï¼Œéœ€è¦æ‰‹åŠ¨è§¦å‘é‡æ–°è®¡ç®—
2. âš ï¸ æ‰¹é‡æ“ä½œæ€§èƒ½å·®ï¼ˆN+1æŸ¥è¯¢é—®é¢˜ï¼‰
3. âš ï¸ ç¼ºå°‘å•ä½è½¬æ¢åŠŸèƒ½ï¼ˆå¦‚ï¼šæ¡¶â†’å…¬æ–¤çš„è½¬æ¢æ¯”ä¾‹ï¼‰
4. âš ï¸ å¤‡æ³¨å­—æ®µè®¡ç®—é€»è¾‘å¤æ‚ï¼Œç»Ÿè®¡ç»“æœä¸å¤Ÿç›´è§‚

### 2.3 ç”¨æˆ·ä½“éªŒé—®é¢˜
1. ğŸ“ äº§å“é…ç½®ç•Œé¢ä¸å¤Ÿç›´è§‚
2. ğŸ“ ç¼ºå°‘æ‰¹é‡é…ç½®åŠŸèƒ½
3. ğŸ“ ç¼ºå°‘å•ä½ä½¿ç”¨æŠ¥è¡¨å’Œåˆ†æ

---

## 3. é‡æ–°è®¾è®¡ç›®æ ‡

### 3.1 æ ¸å¿ƒåŸåˆ™
1. **æ¸…æ™°åˆ†å±‚**ï¼šäº§å“é…ç½® â†’ å•ä½ç®¡ç† â†’ åº“å­˜è®°å½• â†’ æŠ¥è¡¨åˆ†æ
2. **çµæ´»é…ç½®**ï¼šæ”¯æŒä¸åŒäº§å“ç±»å‹ï¼Œçµæ´»çš„å•ä½é…ç½®
3. **æ€§èƒ½ä¼˜å…ˆ**ï¼šä¼˜åŒ–è®¡ç®—å­—æ®µï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
4. **ç”¨æˆ·å‹å¥½**ï¼šç›´è§‚çš„ç•Œé¢ï¼Œæ¸…æ™°çš„å­—æ®µå‘½å

### 3.2 è®¾è®¡ç›®æ ‡
- âœ… æ”¯æŒäº§å“ç±»å‹åˆ†ç±»ï¼Œæ¯ç§ç±»å‹æœ‰ä¸“å±å­—æ®µå’Œå•ä½é…ç½®
- âœ… çµæ´»çš„é™„åŠ å•ä½é…ç½®ï¼ˆå¯é…ç½®å¤šä¸ªå•ä½ï¼‰
- âœ… è‡ªåŠ¨å•ä½è½¬æ¢ï¼ˆå¦‚ï¼š7æ¡¶ Ã— 4.285kg/æ¡¶ = 30kgï¼‰
- âœ… ä¼˜åŒ–çš„è®¡ç®—å­—æ®µï¼Œè‡ªåŠ¨è§¦å‘é‡æ–°è®¡ç®—
- âœ… æ¸…æ™°çš„å­—æ®µå‘½åï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- âœ… å®Œå–„çš„æ‰¹é‡æ“ä½œå’Œæ€§èƒ½ä¼˜åŒ–
- âœ… ä¸°å¯Œçš„æŠ¥è¡¨å’Œåˆ†æåŠŸèƒ½

---

## 4. æ–°æ¶æ„è®¾è®¡

### 4.1 æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”¨æˆ·ç•Œé¢å±‚ (Views)                 â”‚
â”‚  - äº§å“é…ç½®ç•Œé¢                               â”‚
â”‚  - åº“å­˜ç®¡ç†ç•Œé¢                                â”‚
â”‚  - ç§»åŠ¨å†å²ç•Œé¢                                â”‚
â”‚  - æŠ¥è¡¨åˆ†æç•Œé¢                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¸šåŠ¡é€»è¾‘å±‚ (Models)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ äº§å“é…ç½®æ¨¡å—  â”‚  â”‚ å•ä½ç®¡ç†æ¨¡å—  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ åº“å­˜è®¡ç®—æ¨¡å—  â”‚  â”‚ è½¬æ¢è§„åˆ™æ¨¡å—  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ•°æ®å­˜å‚¨å±‚ (Database)              â”‚
â”‚  - product.template (äº§å“é…ç½®)               â”‚
â”‚  - stock.quant (åº“å­˜æ•°é‡)                     â”‚
â”‚  - stock.move.line (ç§»åŠ¨è®°å½•)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ ¸å¿ƒæ¨¡å—åˆ’åˆ†

#### æ¨¡å—1ï¼šäº§å“ç±»å‹ä¸å±æ€§ç®¡ç†
- äº§å“ç±»å‹åˆ†ç±»ï¼ˆåŸè†œã€æˆå“è†œã€æ¶²ä½“ã€åŠæˆå“ï¼‰
- å±æ€§å­—æ®µç®¡ç†ï¼ˆå°ºå¯¸ã€å¯†åº¦ã€å›ºå«ã€ç²˜åº¦ç­‰ï¼‰
- å±æ€§å€¼çš„è®¡ç®—å’ŒéªŒè¯

#### æ¨¡å—2ï¼šé™„åŠ å•ä½é…ç½®ç®¡ç†
- å•ä½æ¨¡æ¿é…ç½®
- å•ä½è½¬æ¢è§„åˆ™
- äº§å“å•ä½å…³è”

#### æ¨¡å—3ï¼šåº“å­˜å•ä½ç®¡ç†
- ç§»åŠ¨è¡Œå•ä½è®°å½•
- åº“å­˜æ•°é‡å•ä½è®¡ç®—
- å•ä½æ±‡æ€»ç»Ÿè®¡

#### æ¨¡å—4ï¼šå®‰å…¨åº“å­˜ç®¡ç†
- å®‰å…¨åº“å­˜è§„åˆ™é…ç½®
- å®æ—¶åº“å­˜æ£€æŸ¥
- é¢„è­¦æé†’

---

## 5. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 5.1 äº§å“ç±»å‹ç®¡ç†

#### äº§å“ç±»å‹å­—æ®µ
```python
product_category_type = fields.Selection([
    ('raw_film', 'åŸè†œ'),
    ('finished_film', 'æˆå“è†œ'),
    ('liquid', 'æ¶²ä½“/é…æ¶²åŸæ–™'),
    ('semi_finished', 'åŠæˆå“åŸè†œ'),
], string='äº§å“ç±»å‹', required=True)
```

#### æ¡ä»¶æ˜¾ç¤ºå­—æ®µ
- **åŸè†œ/åŠæˆå“**ï¼šå®½åº¦ã€åšåº¦ã€é•¿åº¦
- **æˆå“è†œ**ï¼šå®½åº¦ã€åšåº¦ã€é•¿åº¦ã€å‘è´§é‡é‡ç³»æ•°ã€å•ä½é‡é‡
- **æ¶²ä½“**ï¼šå›ºå«ã€ç²˜åº¦

### 5.2 é™„åŠ å•ä½é…ç½®ç³»ç»Ÿ

#### æ”¹è¿›æ–¹æ¡ˆ
1. **æ”¯æŒå¤šå•ä½é…ç½®**
   ```python
   # äº§å“å¯ä»¥é…ç½®å¤šä¸ªå¸¸ç”¨å•ä½
   additional_unit_ids = fields.One2many(
       'product.additional.unit',
       'product_tmpl_id',
       string='é™„åŠ å•ä½é…ç½®'
   )
   ```

2. **å•ä½è½¬æ¢è§„åˆ™**
   ```python
   # å•ä½è½¬æ¢æ¨¡å‹
   class ProductAdditionalUnit(models.Model):
       _name = 'product.additional.unit'
       
       product_tmpl_id = fields.Many2one('product.template')
       unit_name = fields.Selection([...])
       unit_name_custom = fields.Char()
       conversion_rate = fields.Float(string='è½¬æ¢æ¯”ä¾‹')
       is_default = fields.Boolean(string='é»˜è®¤å•ä½')
   ```

3. **å•ä½é€‰æ‹©ä¼˜åŒ–**
   - æ ¹æ®äº§å“ç±»å‹è‡ªåŠ¨æ¨èå•ä½
   - æ”¯æŒå¿«é€Ÿåˆ‡æ¢å•ä½
   - æ˜¾ç¤ºå•ä½è½¬æ¢å…³ç³»

### 5.3 åº“å­˜å•ä½è®¡ç®—ä¼˜åŒ–

#### è®¡ç®—ç­–ç•¥
1. **å®æ—¶è®¡ç®—** + **ç¼“å­˜ä¼˜åŒ–**
   - ä¸»è®¡ç®—ï¼šä½¿ç”¨å­˜å‚¨è®¡ç®—å­—æ®µï¼ˆ`store=True`ï¼‰
   - è§¦å‘æœºåˆ¶ï¼šä½¿ç”¨ä¿¡å·æœºåˆ¶ç›‘å¬ç§»åŠ¨è¡Œå˜åŒ–
   - æ‰¹é‡ä¼˜åŒ–ï¼šä½¿ç”¨ `@api.model_create_multi` å’Œæ‰¹é‡æŸ¥è¯¢

2. **ä¾èµ–å…³ç³»ä¼˜åŒ–**
   ```python
   @api.depends(
       'lot_id', 'product_id', 'quantity', 'location_id',
       # æ·»åŠ åå‘ä¾èµ–ï¼ˆé€šè¿‡ä¿¡å·æœºåˆ¶ï¼‰
   )
   def _compute_lot_unit_info(self):
       # ä¼˜åŒ–åçš„è®¡ç®—é€»è¾‘
   ```

3. **æ€§èƒ½ä¼˜åŒ–**
   - æ‰¹é‡åŠ è½½ç§»åŠ¨è¡Œæ•°æ®
   - ä½¿ç”¨ `read_group` è¿›è¡Œèšåˆè®¡ç®—
   - ç¼“å­˜å¸¸ç”¨æŸ¥è¯¢ç»“æœ

### 5.4 å•ä½è½¬æ¢åŠŸèƒ½

#### è½¬æ¢è§„åˆ™é…ç½®
- æ¡¶ â†’ å…¬æ–¤ï¼šå¯é…ç½®è½¬æ¢æ¯”ä¾‹ï¼ˆå¦‚ï¼š1æ¡¶ = 4.285kgï¼‰
- å· â†’ å¹³æ–¹ç±³ï¼šåŸºäºäº§å“å°ºå¯¸è®¡ç®—
- å¹³æ–¹ç±³ â†’ å…¬æ–¤ï¼šåŸºäºé‡é‡ç³»æ•°è®¡ç®—

#### è‡ªåŠ¨è½¬æ¢
- å…¥åº“æ—¶ï¼šå¦‚æœåªå¡«å†™äº†é™„åŠ å•ä½æ•°é‡ï¼Œè‡ªåŠ¨è®¡ç®—ä¸»å•ä½æ•°é‡
- å‡ºåº“æ—¶ï¼šæ ¹æ®ä¸»å•ä½æ•°é‡ï¼Œè‡ªåŠ¨è®¡ç®—é™„åŠ å•ä½æ•°é‡
- æ˜¾ç¤ºæ—¶ï¼šåŒæ—¶æ˜¾ç¤ºä¸»å•ä½å’Œé™„åŠ å•ä½

---

## 6. æ•°æ®æ¨¡å‹è®¾è®¡

### 6.1 product.template æ‰©å±•

```python
class ProductTemplate(models.Model):
    _inherit = 'product.template'
    
    # ============ äº§å“ç±»å‹åˆ†ç±» ============
    product_category_type = fields.Selection([
        ('raw_film', 'åŸè†œ'),
        ('finished_film', 'æˆå“è†œ'),
        ('liquid', 'æ¶²ä½“/é…æ¶²åŸæ–™'),
        ('semi_finished', 'åŠæˆå“åŸè†œ'),
    ], string='äº§å“ç±»å‹', required=True, default='raw_film')
    
    # ============ é€šç”¨å°ºå¯¸å±æ€§ ============
    product_width_mm = fields.Integer(string="å®½åº¦ (mm)")
    product_thickness_um = fields.Integer(string="åšåº¦ (Î¼m)")
    product_length_m = fields.Float(string="é•¿åº¦ (m)", digits=(12, 2))
    
    # ============ æˆå“è†œä¸“ç”¨å±æ€§ ============
    finished_density_g_per_cm3 = fields.Float(
        string="ææ–™å¯†åº¦ (g/cmÂ³)",
        digits=(12, 3)
    )
    weight_per_sqm_g = fields.Float(
        string="å‘è´§é‡é‡ç³»æ•° (g/ã¡)",
        digits=(12, 2)
    )
    weight_per_sqm_kg = fields.Float(
        string="å•ä½é‡é‡ (kg/mÂ²)",
        digits=(12, 4)
    )
    
    # ============ æ¶²ä½“/é…æ¶²åŸæ–™ä¸“ç”¨å±æ€§ ============
    solid_content_percent = fields.Float(
        string="å›ºå« (%)",
        digits=(12, 2)
    )
    viscosity_value = fields.Float(
        string="ç²˜åº¦å€¼",
        digits=(12, 2)
    )
    
    # ============ è®¡ç®—å­—æ®µ ============
    product_area_sqm = fields.Float(
        string="é¢ç§¯ (ã¡)",
        compute='_compute_product_area',
        store=True
    )
    product_volume_cm3 = fields.Float(
        string="ä½“ç§¯ (cmÂ³)",
        compute='_compute_product_volume',
        store=True
    )
    
    # ============ é™„åŠ å•ä½é…ç½®ï¼ˆæ–°è®¾è®¡ï¼‰ ============
    enable_additional_units = fields.Boolean(
        string="å¯ç”¨é™„åŠ å•ä½",
        default=False
    )
    additional_unit_ids = fields.One2many(
        'product.additional.unit',
        'product_tmpl_id',
        string='é™„åŠ å•ä½é…ç½®'
    )
    default_additional_unit_id = fields.Many2one(
        'product.additional.unit',
        string='é»˜è®¤é™„åŠ å•ä½',
        domain="[('product_tmpl_id', '=', id), ('is_default', '=', True)]"
    )
    
    # ============ å®‰å…¨åº“å­˜ç®¡ç† ============
    safety_stock_qty = fields.Float(
        string='å®‰å…¨åº“å­˜æ•°é‡',
        default=0.0,
        digits=(16, 2)
    )
    safety_stock_rule = fields.Selection([
        ('all', 'åŒ…æ‹¬æ‰€æœ‰åº“å­˜'),
        ('exclude_note1', 'ä¸åŒ…æ‹¬å¤‡æ³¨1'),
        ('exclude_note2', 'ä¸åŒ…æ‹¬å¤‡æ³¨2'),
        ('exclude_both', 'å¤‡æ³¨1å’Œå¤‡æ³¨2éƒ½ä¸åŒ…æ‹¬'),
    ], string='å®‰å…¨åº“å­˜è§„åˆ™', default='exclude_both')
    is_safety_stock_ok = fields.Boolean(
        string='å®‰å…¨åº“å­˜è¾¾æ ‡',
        compute='_compute_safety_stock_status',
        store=True
    )
    
    # ============ åº“å­˜ç»Ÿè®¡å­—æ®µï¼ˆé‡å‘½åï¼‰ ============
    total_additional_unit_qty = fields.Float(
        string="é™„åŠ å•ä½åœ¨æ‰‹æ€»æ•°",
        compute='_compute_total_additional_unit_qty',
        digits=(16, 2)
    )
    total_weight_kg = fields.Float(
        string='æ€»é‡é‡ (kg)',
        compute='_compute_inventory_stats',
        store=True
    )
    total_roll_count = fields.Integer(
        string='æ€»å·æ•°',
        compute='_compute_inventory_stats',
        store=True
    )
    note_summary = fields.Char(
        string='å¤‡æ³¨ç»Ÿè®¡',
        compute='_compute_note_summary'
    )
```

### 6.2 æ–°å¢æ¨¡å‹ï¼šproduct.additional.unit

```python
class ProductAdditionalUnit(models.Model):
    _name = 'product.additional.unit'
    _description = 'äº§å“é™„åŠ å•ä½é…ç½®'
    _order = 'sequence, id'
    
    product_tmpl_id = fields.Many2one(
        'product.template',
        string='äº§å“æ¨¡æ¿',
        required=True,
        ondelete='cascade'
    )
    sequence = fields.Integer(string='æ’åº', default=10)
    
    # å•ä½ä¿¡æ¯
    unit_type = fields.Selection([
        ('kg', 'å…¬æ–¤(kg)'),
        ('roll', 'å·'),
        ('barrel', 'æ¡¶'),
        ('box', 'ç®±'),
        ('bag', 'è¢‹'),
        ('sqm', 'å¹³æ–¹ç±³(ã¡)'),
        ('piece', 'ä»¶'),
        ('custom', 'è‡ªå®šä¹‰'),
    ], string='å•ä½ç±»å‹', required=True)
    
    unit_name_custom = fields.Char(
        string='è‡ªå®šä¹‰å•ä½åç§°',
        help='å½“å•ä½ç±»å‹ä¸º"è‡ªå®šä¹‰"æ—¶å¡«å†™'
    )
    
    # è½¬æ¢è§„åˆ™
    conversion_rate = fields.Float(
        string='è½¬æ¢æ¯”ä¾‹',
        help='ç›¸å¯¹äºä¸»å•ä½çš„è½¬æ¢æ¯”ä¾‹ã€‚ä¾‹å¦‚ï¼š1æ¡¶ = 4.285kgï¼Œåˆ™å¡«å†™ 4.285',
        digits=(16, 4)
    )
    conversion_formula = fields.Text(
        string='è½¬æ¢å…¬å¼',
        help='ä½¿ç”¨äº§å“å±æ€§è®¡ç®—è½¬æ¢æ¯”ä¾‹çš„å…¬å¼ï¼ˆé«˜çº§ç”¨æ³•ï¼‰'
    )
    
    # é…ç½®é€‰é¡¹
    is_default = fields.Boolean(
        string='é»˜è®¤å•ä½',
        default=False,
        help='æ˜¯å¦ä½œä¸ºè¯¥äº§å“çš„é»˜è®¤é™„åŠ å•ä½'
    )
    is_required = fields.Boolean(
        string='å¿…å¡«',
        default=False,
        help='åº“å­˜ç§»åŠ¨æ—¶æ˜¯å¦å¿…é¡»å¡«å†™æ­¤å•ä½æ•°é‡'
    )
    is_active = fields.Boolean(
        string='å¯ç”¨',
        default=True
    )
    
    # æ˜¾ç¤ºåç§°
    display_name = fields.Char(
        string='æ˜¾ç¤ºåç§°',
        compute='_compute_display_name',
        store=True
    )
    
    @api.depends('unit_type', 'unit_name_custom')
    def _compute_display_name(self):
        for rec in self:
            if rec.unit_type == 'custom':
                rec.display_name = rec.unit_name_custom or 'è‡ªå®šä¹‰'
            else:
                unit_map = {
                    'kg': 'å…¬æ–¤(kg)',
                    'roll': 'å·',
                    'barrel': 'æ¡¶',
                    'box': 'ç®±',
                    'bag': 'è¢‹',
                    'sqm': 'å¹³æ–¹ç±³(ã¡)',
                    'piece': 'ä»¶',
                }
                rec.display_name = unit_map.get(rec.unit_type, rec.unit_type)
```

### 6.3 stock.quant æ‰©å±•ï¼ˆä¼˜åŒ–ï¼‰

```python
class StockQuant(models.Model):
    _inherit = 'stock.quant'
    
    # ============ é™„åŠ å•ä½ä¿¡æ¯ï¼ˆä¼˜åŒ–ï¼‰ ============
    additional_unit_type_id = fields.Many2one(
        'product.additional.unit',
        string='é™„åŠ å•ä½',
        compute='_compute_additional_unit_info',
        store=True
    )
    additional_unit_qty = fields.Float(
        string='é™„åŠ å•ä½æ•°é‡',
        compute='_compute_additional_unit_info',
        store=True,
        digits=(16, 2)
    )
    additional_unit_display = fields.Char(
        string='é™„åŠ å•ä½æ˜¾ç¤º',
        compute='_compute_additional_unit_display'
    )
    
    # ============ å¤‡æ³¨å­—æ®µ ============
    note1 = fields.Char(string='å¤‡æ³¨1')
    note2 = fields.Char(string='å¤‡æ³¨2')
    contract_number = fields.Char(string='åˆåŒå·')
    arrival_date = fields.Date(string='åˆ°è´§æ—¥æœŸ')
    
    # ============ ä¼˜åŒ–åçš„è®¡ç®—æ–¹æ³• ============
    @api.depends(
        'lot_id', 'product_id', 'quantity', 'location_id',
        # é€šè¿‡ä¿¡å·æœºåˆ¶ç›‘å¬ move_line å˜åŒ–
    )
    def _compute_additional_unit_info(self):
        """ä¼˜åŒ–åçš„é™„åŠ å•ä½è®¡ç®—é€»è¾‘"""
        # 1. æ‰¹é‡åŠ è½½æ‰€æœ‰ç›¸å…³ç§»åŠ¨è¡Œ
        # 2. ä½¿ç”¨ read_group èšåˆè®¡ç®—
        # 3. ç¼“å­˜è®¡ç®—ç»“æœ
        pass
```

### 6.4 stock.move.line æ‰©å±•ï¼ˆä¼˜åŒ–ï¼‰

```python
class StockMoveLine(models.Model):
    _inherit = 'stock.move.line'
    
    # ============ é™„åŠ å•ä½ä¿¡æ¯ ============
    additional_unit_type_id = fields.Many2one(
        'product.additional.unit',
        string='é™„åŠ å•ä½',
        domain="[('product_tmpl_id', '=', product_id.product_tmpl_id.id)]"
    )
    additional_unit_qty = fields.Float(
        string='é™„åŠ å•ä½æ•°é‡',
        digits=(16, 2)
    )
    
    # ============ è‡ªåŠ¨è½¬æ¢é€»è¾‘ ============
    @api.onchange('additional_unit_qty', 'additional_unit_type_id', 'quantity')
    def _onchange_unit_conversion(self):
        """å•ä½è‡ªåŠ¨è½¬æ¢"""
        # æ ¹æ®è½¬æ¢æ¯”ä¾‹è‡ªåŠ¨è®¡ç®—ä¸»å•ä½æˆ–é™„åŠ å•ä½
        pass
```

---

## 7. è§†å›¾ä¸äº¤äº’è®¾è®¡

### 7.1 äº§å“é…ç½®ç•Œé¢

#### é¡µé¢1ï¼šåŸºæœ¬ä¿¡æ¯
- äº§å“ç±»å‹é€‰æ‹©ï¼ˆå¿…å¡«ï¼‰
- æ ¹æ®äº§å“ç±»å‹æ˜¾ç¤ºç›¸åº”å±æ€§å­—æ®µ
- è‡ªåŠ¨éšè—ä¸ç›¸å…³å­—æ®µ

#### é¡µé¢2ï¼šé™„åŠ å•ä½é…ç½®
- å•ä½é…ç½®åˆ—è¡¨ï¼ˆå¯é…ç½®å¤šä¸ªï¼‰
- æ¯ä¸ªå•ä½ï¼šç±»å‹ã€è½¬æ¢æ¯”ä¾‹ã€æ˜¯å¦é»˜è®¤ã€æ˜¯å¦å¿…å¡«
- æ”¯æŒæ‹–æ‹½æ’åº
- å¿«é€Ÿè®¾ç½®å‘å¯¼

#### é¡µé¢3ï¼šå®‰å…¨åº“å­˜
- å®‰å…¨åº“å­˜æ•°é‡
- å®‰å…¨åº“å­˜è§„åˆ™é€‰æ‹©
- å®æ—¶æ˜¾ç¤ºæ˜¯å¦è¾¾æ ‡

### 7.2 åº“å­˜ç®¡ç†ç•Œé¢

#### åˆ—è¡¨è§†å›¾ä¼˜åŒ–
- åˆ—é¡ºåºï¼šäº§å“ â†’ æ‰¹æ¬¡ â†’ ä¸»å•ä½æ•°é‡ â†’ é™„åŠ å•ä½æ•°é‡ â†’ é™„åŠ å•ä½ â†’ åˆ°è´§æ—¥æœŸ â†’ å¤‡æ³¨1 â†’ å¤‡æ³¨2 â†’ åˆåŒå·
- æ”¯æŒæŒ‰é™„åŠ å•ä½ç­›é€‰å’Œåˆ†ç»„
- æ”¯æŒé™„åŠ å•ä½æ•°é‡æ±‡æ€»

#### è¡¨å•è§†å›¾
- åˆ†ç»„æ˜¾ç¤ºï¼šåŸºæœ¬ä¿¡æ¯ã€é™„åŠ å•ä½ä¿¡æ¯ã€å¤‡æ³¨ä¿¡æ¯
- é™„åŠ å•ä½è‡ªåŠ¨å¡«å……å’Œè½¬æ¢

### 7.3 ç§»åŠ¨å†å²ç•Œé¢

#### ä¼˜åŒ–
- é™„åŠ å•ä½å’Œæ•°é‡æ˜¾ç¤ºåœ¨"å•ä½"åˆ—ä¹‹å
- æ”¯æŒæŒ‰é™„åŠ å•ä½ç­›é€‰
- æ”¯æŒé™„åŠ å•ä½æ±‡æ€»ç»Ÿè®¡

---

## 8. æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 8.1 è®¡ç®—å­—æ®µä¼˜åŒ–

#### ç­–ç•¥1ï¼šä¿¡å·æœºåˆ¶è§¦å‘
```python
from odoo import signals

@signals.on_write('stock.move.line', 'lot_quantity')
def on_move_line_lot_quantity_change(move_line):
    # è§¦å‘ç›¸å…³çš„ stock_quant é‡æ–°è®¡ç®—
    quants = env['stock.quant'].search([
        ('lot_id', '=', move_line.lot_id.id),
        ('product_id', '=', move_line.product_id.id),
    ])
    quants._compute_additional_unit_info()
```

#### ç­–ç•¥2ï¼šæ‰¹é‡è®¡ç®—ä¼˜åŒ–
```python
def _compute_additional_unit_info(self):
    # æ‰¹é‡åŠ è½½æ‰€æœ‰ç§»åŠ¨è¡Œ
    all_lot_ids = self.mapped('lot_id.id')
    all_product_ids = self.mapped('product_id.id')
    
    move_lines = self.env['stock.move.line'].read_group(
        [('lot_id', 'in', all_lot_ids), 
         ('product_id', 'in', all_product_ids),
         ('state', '=', 'done')],
        ['lot_id', 'product_id', 'location_dest_id', 
         'location_id', 'additional_unit_qty:sum'],
        ['lot_id', 'product_id', 'location_dest_id', 'location_id'],
        lazy=False
    )
    
    # ä½¿ç”¨å­—å…¸å¿«é€ŸæŸ¥æ‰¾å’Œè®¡ç®—
    # ...
```

### 8.2 æŸ¥è¯¢ä¼˜åŒ–

- ä½¿ç”¨ `read_group` æ›¿ä»£å¤šæ¬¡ `search`
- ä½¿ç”¨ `prefetch` é¢„åŠ è½½å…³è”æ•°æ®
- ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–å¸¸ç”¨æŸ¥è¯¢å­—æ®µ

### 8.3 ç¼“å­˜ç­–ç•¥

- ç¼“å­˜äº§å“å•ä½é…ç½®
- ç¼“å­˜è½¬æ¢æ¯”ä¾‹è®¡ç®—ç»“æœ
- ä½¿ç”¨ `@api.model` ç¼“å­˜å¸¸ç”¨æŸ¥è¯¢

---

## 9. å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šæ•°æ®æ¨¡å‹é‡æ„ï¼ˆ1-2å¤©ï¼‰
1. âœ… åˆ›å»º `product.additional.unit` æ¨¡å‹
2. âœ… é‡æ„ `product.template` å­—æ®µ
3. âœ… æ·»åŠ äº§å“ç±»å‹åˆ†ç±»
4. âœ… è¿ç§»ç°æœ‰æ•°æ®

### é˜¶æ®µ2ï¼šè®¡ç®—é€»è¾‘ä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰
1. âœ… é‡æ„ `stock_quant._compute_additional_unit_info`
2. âœ… å®ç°ä¿¡å·æœºåˆ¶è§¦å‘
3. âœ… ä¼˜åŒ–æ‰¹é‡è®¡ç®—
4. âœ… æ·»åŠ å•ä½è½¬æ¢é€»è¾‘

### é˜¶æ®µ3ï¼šè§†å›¾ä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
1. âœ… é‡æ„äº§å“é…ç½®ç•Œé¢
2. âœ… ä¼˜åŒ–åº“å­˜ç®¡ç†ç•Œé¢
3. âœ… ä¼˜åŒ–ç§»åŠ¨å†å²ç•Œé¢
4. âœ… æ·»åŠ å¿«é€Ÿè®¾ç½®å‘å¯¼

### é˜¶æ®µ4ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
1. âœ… åŠŸèƒ½æµ‹è¯•
2. âœ… æ€§èƒ½æµ‹è¯•
3. âœ… æ•°æ®è¿ç§»éªŒè¯
4. âœ… ç”¨æˆ·éªŒæ”¶æµ‹è¯•

### é˜¶æ®µ5ï¼šæ–‡æ¡£ä¸åŸ¹è®­ï¼ˆ1å¤©ï¼‰
1. âœ… æ›´æ–°ç”¨æˆ·æ‰‹å†Œ
2. âœ… åˆ›å»ºæ“ä½œè§†é¢‘
3. âœ… åŸ¹è®­ç”¨æˆ·

---

## 10. é£é™©è¯„ä¼°ä¸åº”å¯¹

### é£é™©1ï¼šæ•°æ®è¿ç§»é—®é¢˜
**åº”å¯¹**ï¼š
- åˆ›å»ºæ•°æ®è¿ç§»è„šæœ¬
- åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
- ä¿ç•™å›æ»šæ–¹æ¡ˆ

### é£é™©2ï¼šæ€§èƒ½å½±å“
**åº”å¯¹**ï¼š
- åˆ†é˜¶æ®µä¸Šçº¿
- ç›‘æ§æ€§èƒ½æŒ‡æ ‡
- å‡†å¤‡ä¼˜åŒ–æ–¹æ¡ˆ

### é£é™©3ï¼šç”¨æˆ·é€‚åº”
**åº”å¯¹**ï¼š
- ä¿æŒç•Œé¢å…¼å®¹æ€§
- æä¾›è¯¦ç»†æ–‡æ¡£
- é€æ­¥å¼•å¯¼ç”¨æˆ·

---

## 11. åç»­æ‰©å±•è®¡åˆ’

### åŠŸèƒ½æ‰©å±•
1. å•ä½ä½¿ç”¨æŠ¥è¡¨å’Œåˆ†æ
2. å•ä½è½¬æ¢å†å²è®°å½•
3. æ‰¹é‡å•ä½é…ç½®å¯¼å…¥
4. ç§»åŠ¨ç«¯æ”¯æŒ

### é›†æˆæ‰©å±•
1. ä¸é‡‡è´­æ¨¡å—æ·±åº¦é›†æˆ
2. ä¸é”€å”®æ¨¡å—æ·±åº¦é›†æˆ
3. ä¸åˆ¶é€ æ¨¡å—æ·±åº¦é›†æˆ

---

## 12. æ€»ç»“

è¿™ä¸ªé‡æ–°è®¾è®¡æ–¹æ¡ˆæ—¨åœ¨ï¼š
- âœ… è§£å†³å½“å‰æ¶æ„é—®é¢˜
- âœ… æå‡ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
- âœ… ä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ
- âœ… æ”¯æŒä¼ä¸šå®é™…ä¸šåŠ¡éœ€æ±‚
- âœ… ä¸ºæœªæ¥æ‰©å±•é¢„ç•™ç©ºé—´

**ä¸‹ä¸€æ­¥**ï¼šè¯·æ‚¨å®¡é˜…æ­¤æ–¹æ¡ˆï¼Œæå‡ºä¿®æ”¹æ„è§åï¼Œæˆ‘å°†å¼€å§‹å®æ–½é‡æ„ã€‚

